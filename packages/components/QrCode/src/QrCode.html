<div class="qrcode">
  <img class="qrimg" ref:qrimg alt="qr code"/>
</div>

<script>
  import QR from 'qrious'

  const SIZES = {
    SMALL: 50,
    MEDIUM: 140,
    LARGE: 240,
  }

  export default {
    data() {
      return {
        size: 'medium',
        level: 'M',
        foreground: 'black',
        value: '',
        logo: undefined,
        __qr: {},
      }
    },
    methods: {
      createQr() {
        const qrimg = this.refs['qrimg']
        const qr = new QR(this.getSpecs())
        qrimg.setAttribute('src', qr.toDataURL('image/jpeg'))
        this.set({ __qr: qr })
      },
      getSpecs() {
        const specs = this.get()
        return {
          size: SIZES[String(specs['size']).toUpperCase()],
          foreground: specs['foreground'],
          value: specs['value'],
          level: specs['level'],
        }
      },
    },
    oncreate() {
      this.createQr()
    },
    onupdate() {
      const qr = this.get()['__qr']
      qr.set(this.getSpecs())
      this.refs['qrimg'].setAttribute('src', qr.toDataURL('image/jpeg'))
    },
  }
</script>

<style>
</style>
